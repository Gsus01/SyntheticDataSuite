# 2.1 Diagrama de Contexto (C4 Nivel 1)

## Introducción

El diagrama de contexto representa el nivel más alto de abstracción dentro del modelo C4. Su propósito es mostrar cómo la plataforma encaja en su entorno, identificando:

- Los **usuarios** que interactúan con el sistema
- Los **sistemas externos** de los que depende

Este nivel de abstracción resulta útil para comunicar el alcance del sistema a stakeholders no técnicos o para onboarding de nuevos miembros del equipo.

---

## Diagrama

![Diagrama de Contexto C4](diagrams/c4-contexto.puml)

> **Nota**: El diagrama se genera a partir del fichero PlantUML ubicado en `diagrams/c4-contexto.puml`. Puede visualizarse con la extensión PlantUML de VS Code o exportarse a PNG/SVG.

---

## Elementos del Diagrama

### Usuario: Investigador / Desarrollador

| Atributo | Descripción |
|----------|-------------|
| **Rol** | Usuario principal del sistema |
| **Responsabilidades** | Diseña flujos de trabajo visuales, sube datasets de entrada, ejecuta workflows y monitoriza resultados |
| **Interacción** | Accede a la plataforma mediante interfaz web (HTTPS) |

El usuario investigador representa a cualquier persona que utilice la herramienta visual para definir y ejecutar pipelines de procesamiento. No se requieren conocimientos profundos de Kubernetes o Argo para operar la plataforma.

---

### Sistema: Plataforma de Ejecución de Workflows

| Atributo | Descripción |
|----------|-------------|
| **Tipo** | Sistema principal (scope del proyecto) |
| **Propósito** | Diseñar, ejecutar y monitorizar pipelines de procesamiento mediante una interfaz visual basada en grafos |
| **Tecnologías principales** | Frontend (Next.js + React Flow), Backend (FastAPI) |

La plataforma actúa como intermediario entre el usuario y la infraestructura subyacente. Traduce los flujos visuales diseñados por el usuario a workflows ejecutables en contenedores, abstrayendo la complejidad de Kubernetes y Argo Workflows.

> [!NOTE]
> Aunque el repositorio incluye componentes orientados a la generación de datos sintéticos, la plataforma está diseñada de forma genérica. Puede ejecutar cualquier workflow que siga las convenciones de entrada/salida definidas, lo que la hace extensible a otros casos de uso.

---

### Sistemas Externos

#### MinIO / S3 Storage

| Atributo | Descripción |
|----------|-------------|
| **Tipo** | Almacenamiento de objetos |
| **Protocolo** | S3-compatible API |
| **Uso** | Almacena artefactos de entrada (datasets subidos), artefactos de salida (resultados) y manifiestos de workflows |

**¿Por qué MinIO?**
- Proporciona una API compatible con S3, lo que facilita la portabilidad hacia proveedores cloud (AWS S3, GCS, Azure Blob)
- Permite despliegue on-premise sin dependencias externas
- Es el backend de artefactos soportado nativamente por Argo Workflows

#### Argo Workflows

| Atributo | Descripción |
|----------|-------------|
| **Tipo** | Motor de orquestación |
| **Protocolo** | REST API |
| **Uso** | Ejecuta los workflows definidos como DAGs, gestiona el ciclo de vida de los pods, proporciona logs y estado de ejecución |

**¿Por qué Argo Workflows?**
- Nativo de Kubernetes: los workflows se definen como recursos CRD
- Soporte para DAGs complejos con dependencias entre pasos
- Integración directa con almacenamiento S3 para artefactos
- API REST para consultar estado y logs en tiempo real

#### Kubernetes Cluster

| Atributo | Descripción |
|----------|-------------|
| **Tipo** | Plataforma de orquestación de contenedores |
| **Protocolo** | K8s API (usado por Argo) |
| **Uso** | Ejecuta los contenedores que procesan cada paso del workflow |

Kubernetes proporciona la infraestructura sobre la que Argo despliega los pods. En el entorno de desarrollo se utiliza **minikube** para simular un clúster local.

#### Container Registry

| Atributo | Descripción |
|----------|-------------|
| **Tipo** | Almacenamiento de imágenes Docker |
| **Protocolo** | Docker Registry API |
| **Uso** | Almacena las imágenes de contenedor utilizadas por los pasos del workflow |

El Container Registry (Docker Hub, registro privado, etc.) es necesario para que Kubernetes pueda descargar las imágenes que ejecutan cada paso del workflow. En entornos de producción se suele utilizar un registro privado para controlar versiones y seguridad de las imágenes.

---

## Relaciones

| Origen | Destino | Descripción | Protocolo |
|--------|---------|-------------|-----------|
| Usuario | Plataforma | Diseña flujos, sube datos, ejecuta y monitoriza | HTTPS |
| Plataforma | MinIO | Almacena y recupera artefactos | S3 API |
| Plataforma | Argo | Envía workflows, consulta estado y logs | REST API |
| Argo | Kubernetes | Crea y gestiona pods para cada paso | K8s API |
| Argo | MinIO | Lee/escribe artefactos entre pasos del workflow | S3 API |
| Kubernetes | Registry | Descarga imágenes de contenedor | Docker Registry API |

---

## Consideraciones de Diseño

### Desacoplamiento

La arquitectura separa claramente las responsabilidades:

- **Plataforma**: Interfaz de usuario y traducción de flujos visuales
- **Argo**: Ejecución y orquestación de workflows
- **MinIO**: Persistencia de datos
- **Kubernetes**: Infraestructura de cómputo
- **Registry**: Almacenamiento y distribución de imágenes

Esta separación permite:
1. Escalar cada componente de forma independiente
2. Sustituir componentes (p.ej. MinIO por AWS S3) sin modificar la lógica de la plataforma
3. Facilitar el testing mediante mocks de los sistemas externos

### Portabilidad

Al basarse en estándares abiertos (S3, Kubernetes, REST, OCI), la plataforma puede desplegarse tanto en entornos on-premise como en proveedores cloud que ofrezcan Kubernetes gestionado (EKS, AKS, GKE).

### Extensibilidad

El diseño genérico permite que la plataforma soporte diversos casos de uso más allá de la generación de datos sintéticos, tales como:
- Pipelines de entrenamiento ML/AI
- Flujos de transformación y ETL de datos
- Trabajos de procesamiento batch
- Cualquier procesamiento contenerizado que siga las convenciones de entrada/salida
