@startuml serialization_flow
title Workflow Serialization and Persistence

skinparam participant {
    BackgroundColor #e3f2fd
    BorderColor #1565c0
}

actor User
participant "Frontend\n(React)" as FE
participant "Backend\n(FastAPI)" as BE
database "MinIO\n(S3)" as S3

User -> FE : Click "Save"
activate FE

FE -> FE : Sanitize nodes\n(remove runtimeStatus)
FE -> FE : Serialize to JSON

FE -> BE : POST /workflows\n{name, nodes, edges, ...}
activate BE

BE -> BE : Validate with Pydantic
BE -> BE : Generate workflowId\n(if new)
BE -> BE : Add timestamps\n(createdAt, updatedAt)
BE -> BE : Build StoredWorkflowRecord

BE -> S3 : PUT workflows/{id}.json
S3 --> BE : 200 OK

BE --> FE : { workflowId, name, ... }
deactivate BE

FE --> User : "Workflow saved"
deactivate FE

@enduml
