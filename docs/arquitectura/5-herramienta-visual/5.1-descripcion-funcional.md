# 5.1. Descripci√≥n Funcional

## Introducci√≥n

Este apartado describe las funcionalidades que ofrece la herramienta visual de gesti√≥n de flujos de trabajo. El objetivo es documentar **qu√© puede hacer un usuario** con la interfaz, sin entrar en detalles de implementaci√≥n t√©cnica (que se abordar√°n en las siguientes secciones).

La herramienta proporciona un entorno visual interactivo que permite dise√±ar, configurar, ejecutar y monitorizar flujos de trabajo complejos de forma intuitiva, reduciendo la barrera de entrada para usuarios que no son expertos en orquestaci√≥n de contenedores.

---

## Estructura General de la Interfaz

La interfaz se divide en tres √°reas principales:

| √Årea | Funci√≥n |
|:-----|:--------|
| **Panel lateral (Sidebar)** | Cat√°logo de nodos disponibles, organizados por categor√≠a |
| **Canvas central** | √Årea de trabajo donde se dibuja el flujo de trabajo |
| **Panel de inspecci√≥n** | Configuraci√≥n detallada del nodo seleccionado |

Adicionalmente, existe una **barra de herramientas superior** con acciones globales (nuevo, guardar, cargar, compilar, ejecutar) y un **terminal integrado** que muestra el estado de ejecuci√≥n.

> üì∑ **Ubicaci√≥n de captura**: Vista general de la interfaz mostrando las tres √°reas principales.

---

## Acciones Funcionales

### 1. Explorar el Cat√°logo de Nodos

El panel lateral presenta todos los tipos de nodos disponibles, organizados por categor√≠as:

- **Entrada**: Nodos que representan datos de entrada al flujo.
- **Preprocesamiento**: Transformaci√≥n y limpieza de datos.
- **Entrenamiento**: Algoritmos de machine learning.
- **Generaci√≥n**: Creaci√≥n de datos sint√©ticos.
- **Salida**: Puntos de finalizaci√≥n del flujo.

El cat√°logo se carga din√°micamente desde el backend y puede extenderse sin modificar el c√≥digo del frontend.

> üì∑ **Ubicaci√≥n de captura**: Panel lateral mostrando el cat√°logo de nodos por categor√≠a.

---

### 2. Arrastrar y Soltar Nodos al Canvas

El usuario puede **arrastrar** cualquier nodo del cat√°logo y **soltarlo** en la posici√≥n deseada del canvas. Al soltar un nodo:

1. Se crea una instancia del nodo en el canvas.
2. Se asignan autom√°ticamente los puertos de entrada/salida seg√∫n el template.
3. El nodo queda listo para ser conectado y configurado.

![Drag and Drop Flow](diagrams/5.1-drag-drop-flow.puml)

> üì∑ **Ubicaci√≥n de captura**: Secuencia mostrando el arrastre de un nodo desde el sidebar al canvas.

---

### 3. Conectar Nodos Entre S√≠

Los nodos se conectan mediante **aristas** que representan el flujo de datos. Para crear una conexi√≥n:

1. El usuario hace clic en un puerto de salida de un nodo.
2. Arrastra hasta un puerto de entrada de otro nodo.
3. La conexi√≥n se valida y se dibuja con una flecha.

Las conexiones determinan:
- El orden de ejecuci√≥n (dependencias en el DAG).
- Qu√© artefactos de salida alimentan qu√© entradas.

> üì∑ **Ubicaci√≥n de captura**: Conexi√≥n entre un nodo de preprocesamiento y uno de entrenamiento.

---

### 4. Seleccionar y Configurar un Nodo

Al hacer clic en un nodo del canvas, se abre el **Panel de Inspecci√≥n** con:

- Nombre y tipo del nodo.
- Estado de ejecuci√≥n (si el workflow est√° corriendo).
- Par√°metros configurables espec√≠ficos del nodo.
- Informaci√≥n de artefactos de entrada/salida.

El usuario puede modificar los par√°metros directamente en este panel. Los cambios se reflejan inmediatamente en el estado del workflow.

![Node Inspection Flow](diagrams/5.1-node-inspection-flow.puml)

> üì∑ **Ubicaci√≥n de captura**: Panel de inspecci√≥n mostrando los par√°metros de un nodo de entrenamiento.

---

### 5. Subir Archivos de Entrada

Para nodos de tipo "entrada" o nodos que requieren ficheros de configuraci√≥n, el usuario puede:

1. Seleccionar el nodo en el canvas.
2. En el panel de inspecci√≥n, usar el selector de ficheros.
3. El archivo se sube autom√°ticamente a MinIO/S3.
4. El nodo queda vinculado al artefacto subido.

El sistema muestra informaci√≥n del fichero subido (nombre, tama√±o, tipo MIME).

> üì∑ **Ubicaci√≥n de captura**: Subida de un archivo CSV a un nodo de entrada.

---

### 6. Compilar el Workflow

Antes de ejecutar, el usuario debe **compilar** el workflow. Esta acci√≥n:

1. Valida que el grafo es un DAG v√°lido (sin ciclos).
2. Genera el manifiesto de Argo Workflows en formato YAML.
3. Guarda el manifiesto en MinIO para referencia.

Si la compilaci√≥n falla (por ejemplo, por ciclos o nodos sin conectar), se muestra un mensaje de error descriptivo.

> üì∑ **Ubicaci√≥n de captura**: Bot√≥n de compilar y mensaje de √©xito/error.

---

### 7. Ejecutar el Workflow

Una vez compilado, el usuario puede **enviar** el workflow a ejecuci√≥n:

1. Se env√≠a el manifiesto a Argo Workflows.
2. Se abre autom√°ticamente el terminal integrado.
3. Comienza el polling de estado para actualizar la interfaz.

Los nodos del canvas cambian de color seg√∫n su estado de ejecuci√≥n (pendiente, ejecutando, completado, fallido).

![Workflow Execution States](diagrams/5.1-workflow-execution-states.puml)

> üì∑ **Ubicaci√≥n de captura**: Workflow en ejecuci√≥n con nodos en diferentes estados.

---

### 8. Monitorizar el Estado de Ejecuci√≥n

Durante la ejecuci√≥n, el usuario puede ver en tiempo real:

- **Estado global** del workflow (Running, Succeeded, Failed).
- **Estado de cada nodo** individual (badges de color en el canvas).
- **Logs** de ejecuci√≥n en el terminal integrado.

El panel de inspecci√≥n de un nodo en ejecuci√≥n muestra:
- Fase actual (Pending, Running, Succeeded, Failed).
- Tiempos de inicio y finalizaci√≥n.
- Mensajes de error (si los hay).

> üì∑ **Ubicaci√≥n de captura**: Terminal mostrando logs de ejecuci√≥n en tiempo real.

---

### 9. Descargar y Previsualizar Artefactos de Salida

Una vez que un nodo completa su ejecuci√≥n, el usuario puede:

1. Seleccionar el nodo en el canvas.
2. En la secci√≥n "Artefactos de salida" del panel de inspecci√≥n:
   - **Previsualizar**: Ver los primeros bytes del fichero (CSV, JSON, texto).
   - **Descargar**: Obtener el fichero completo localmente.

Esto permite inspeccionar resultados intermedios sin salir de la interfaz.

> üì∑ **Ubicaci√≥n de captura**: Previsualizaci√≥n de un CSV de salida de un nodo de generaci√≥n.

---

### 10. Guardar y Cargar Workflows

El usuario puede persistir sus workflows para uso futuro:

#### Guardar
- Abre el modal de guardado.
- Introduce nombre y descripci√≥n opcional.
- El workflow se persiste en MinIO (nodos, aristas, par√°metros, manifiesto compilado).

#### Cargar
- Abre el modal de carga.
- Muestra lista de workflows guardados (nombre, fecha de modificaci√≥n).
- Al seleccionar uno, se restaura completamente el estado del canvas.

> üì∑ **Ubicaci√≥n de captura**: Modal de carga mostrando lista de workflows guardados.

---

### 11. Crear un Nuevo Workflow

El bot√≥n "Nuevo" permite limpiar el canvas y comenzar un workflow desde cero. Si hay cambios sin guardar, se muestra un di√°logo de confirmaci√≥n para evitar p√©rdida de datos accidental.

> üì∑ **Ubicaci√≥n de captura**: Di√°logo de confirmaci√≥n al crear nuevo workflow con cambios pendientes.

---

## Resumen de Acciones

| Acci√≥n | Implementado en Prototipo | Descripci√≥n |
|:-------|:--------------------------|:------------|
| Ver cat√°logo de nodos | ‚úÖ | Sidebar con categor√≠as din√°micas |
| Drag & drop de nodos | ‚úÖ | Crear nodos arrastrando desde sidebar |
| Conectar nodos | ‚úÖ | Aristas con flechas direccionales |
| Seleccionar y configurar nodo | ‚úÖ | Panel de inspecci√≥n lateral |
| Subir archivos de entrada | ‚úÖ | Upload a MinIO desde el inspector |
| Compilar workflow | ‚úÖ | Genera manifiesto YAML de Argo |
| Ejecutar workflow | ‚úÖ | Env√≠a a Argo, abre terminal |
| Monitorizar ejecuci√≥n | ‚úÖ | Polling + actualizaci√≥n visual de nodos |
| Previsualizar artefactos | ‚úÖ | Vista previa de CSV/JSON/texto |
| Descargar artefactos | ‚úÖ | Descarga ficheros de salida |
| Guardar workflow | ‚úÖ | Persistencia en MinIO como JSON |
| Cargar workflow | ‚úÖ | Restauraci√≥n completa del canvas |
| Nuevo workflow | ‚úÖ | Limpia canvas con confirmaci√≥n |
| Eliminar nodo | ‚úÖ | Teclado (Delete/Backspace) o context menu |
| Eliminar arista | ‚úÖ | Click en arista + Delete |
| Zoom y pan del canvas | ‚úÖ | Scroll + drag en √°rea vac√≠a |
| Multi-selecci√≥n | ‚úÖ | Shift+click o √°rea de selecci√≥n |

---

## Funcionalidades Futuras (Arquitectura Objetivo)

Las siguientes funcionalidades no est√°n implementadas en el prototipo pero forman parte de la visi√≥n de la arquitectura objetivo:

| Funcionalidad | Descripci√≥n |
|:--------------|:------------|
| **Autenticaci√≥n de usuarios** | Login, roles, permisos por workflow |
| **Historial de ejecuciones** | Ver ejecuciones pasadas de un workflow |
| **Versionado de workflows** | Guardar m√∫ltiples versiones, diff visual |
| **Clonaci√≥n de workflows** | Duplicar un workflow existente |
| **Comentarios y anotaciones** | A√±adir notas a nodos o al canvas |
| **Validaci√≥n en tiempo real** | Marcar conexiones inv√°lidas mientras se edita |
| **Templates de workflows** | Galer√≠a de workflows predefinidos |
| **Exportar/Importar JSON** | Backup manual de definiciones |
