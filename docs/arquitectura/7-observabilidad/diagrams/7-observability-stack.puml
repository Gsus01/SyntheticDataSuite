@startuml observability_stack
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_TOP_DOWN()
LAYOUT_WITH_LEGEND()

title Observability Stack

System_Boundary(k8s, "Kubernetes Cluster") {
    Container(backend, "Backend API", "FastAPI", "Logs + Metrics")
    Container(frontend, "Frontend", "Next.js", "Logs")
    Container(workflows, "Workflow Pods", "Argo", "Logs + Metrics")
    
    Container(node_exp, "Node Exporter", "DaemonSet", "Host Metrics")
}

System_Boundary(observability, "Observability Stack") {
    Container(promtail, "Promtail", "Agent", "Collects logs")
    
    Container(loki, "Loki", "Logs DB", "Log aggregation")
    Container(prometheus, "Prometheus", "Metrics DB", "Time-series")
    
    Container(alertmanager, "Alertmanager", "Alerts", "Routing")
    Container(grafana, "Grafana", "Visualization", "Dashboards")
}

System_Ext(slack, "Slack", "Notifications")

' Logging Flow (Vertical)
Rel(backend, promtail, "stdout")
Rel(frontend, promtail, "stdout")
Rel(workflows, promtail, "stdout")
Rel_D(promtail, loki, "Push logs")

' Metrics Flow (Vertical)
Rel(prometheus, backend, "Scrape")
Rel(prometheus, workflows, "Scrape")
Rel(prometheus, node_exp, "Scrape")

' Visualization (Bottom-Up)
Rel_U(grafana, loki, "Query")
Rel_U(grafana, prometheus, "Query")

' Alerting (Down)
Rel_D(prometheus, alertmanager, "Alerts")
Rel_D(alertmanager, slack, "Notify")

@enduml
