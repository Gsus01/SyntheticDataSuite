@startuml target_services_communication
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()
LAYOUT_LEFT_RIGHT()

title Target Architecture - Service Communication (C4 Level 2)

Person(user, "User", "Researcher / Developer")

System_Boundary(platform, "Workflow Execution Platform") {
    Container(gateway, "API Gateway", "Kong / Traefik", "Authentication, rate limiting, routing")
    Container(auth, "Auth Service", "Keycloak", "OAuth2/OIDC, RBAC")
    Container(workflow, "Workflow Service", "FastAPI", "CRUD, compile to YAML")
    Container(execution, "Execution Service", "FastAPI", "Submit, status, logs")
    Container(artifact, "Artifact Service", "FastAPI", "Upload, download, preview")
}

System_Ext(postgres, "PostgreSQL", "Metadata database")
System_Ext(minio, "MinIO", "Object storage (S3)")
System_Ext(argo, "Argo Workflows", "Orchestration engine")

Rel(user, gateway, "Uses", "HTTPS")

Rel(gateway, auth, "Validates", "REST")
Rel(gateway, workflow, "Routes", "REST")
Rel(gateway, execution, "Routes", "REST")
Rel(gateway, artifact, "Routes", "REST")

Rel(auth, postgres, "Stores sessions")
Rel(workflow, postgres, "Stores definitions")
Rel(execution, argo, "Submit/status", "REST")
Rel(artifact, minio, "Store/retrieve", "S3 API")

@enduml
