services:
  timeseries-preprocessor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ts-preprocessor
    volumes:
      - ./test_data:/app/data/input:ro
      - ./output:/app/data/output
      - ./config.yaml:/app/config.yaml:ro
    environment:
      - PYTHONUNBUFFERED=1
    user: "${UID:-1000}:${GID:-1000}"
    command: ["--config", "/app/config.yaml", "--input", "/app/data/input/sensor_data_with_nulls.csv", "--output", "/app/data/output/processed_sensor_data.csv"]

  batch-processor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ts-batch-processor
    volumes:
      - ./test_data:/app/data/input:ro
      - ./output:/app/data/output
      - ./batch_config.yaml:/app/config.yaml:ro
    environment:
      - PYTHONUNBUFFERED=1
    user: "${UID:-1000}:${GID:-1000}"
    profiles:
      - batch
    command: ["--config", "/app/config.yaml", "--input", "/app/data/input/financial_data_with_outliers.csv", "--output", "/app/data/output/batch_processed_data.csv"]
